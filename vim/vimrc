" Created:  Tue 12 Aug 2014
" Modified: Fri 08 May 2015
" Author:   Josh Wainwright
" Filename: vimrc

" Paths and Variables            {{{1
"

if has('unix')
	let $VIMHOME=$HOME.'/.vim/'
elseif has('win32')
	let $VIMHOME=$HOME.'/vimfiles/'
	let $PATH=$PATH.';C:/cygwin/bin/;'.$HOME.'/Tools/'
endif

" Vim-Plug Plugins               {{{1
"

if empty(glob($VIMHOME.'autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
    \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd VimEnter * PlugInstall
endif
let g:plug_threads = 6
let g:plug_timeout = 20

if executable('git')
	call plug#begin($VIMHOME.'plugged')

	let g:plug_url_format = 'https://git@github.com/%s.git'
	"Show buffers in tabline at top of window
	Plug 'ap/vim-buftabline'
	"Git management from withing vim
	Plug 'tpope/vim-fugitive'
	"Gitk for vim
	Plug 'gregsexton/gitv', {'on': 'Gitv'}
	if has('python')
		"Snippet management
		"Plug 'SirVer/ultisnips'
		"Plug 'honza/vim-snippets'
		" command! UltiSnipsLoad :
	endif
	"Syntax checking for a wide range of languages
	"Plug 'scrooloose/syntastic'
	"Easy commenting/uncommenting of code.
	Plug 'tpope/vim-commentary'
	"Simple alignment of lines
	Plug 'godlygeek/tabular'
	"Multiple useful keybindings
	Plug 'tpope/vim-unimpaired'
	"Simple minimalist alternative to netrw
	Plug 'jeetsukumaran/vim-filebeagle'
	"Allow incrementing true/false values etc.
	Plug 'nishigori/increment-activator'
	"Make f (forward) and t (to) better
	Plug 'clever-f.vim'
	"Code structure overview
	Plug 'majutsushi/tagbar'

	if executable('vifm')
		"Documentation for vifm
		Plug 'istib/vifm.vim'
	endif

	" Simple file manipulation
	Plug 'joshaw/vim-eunuch'
	"View man pages with vim
	Plug 'joshaw/vim-superman', {'on' : 'SuperMan'}

	"Filetypes
	Plug 'm42e/trace32-practice.vim'
	"Plug 'jamessan/vim-gnupg'
	Plug 'tomtom/tgpg_vim'
	Plug 'terryma/vim-multiple-cursors'

	call plug#end()
endif " executable(git)

" Plugin Settings                {{{1
"

"""" UltiSnips Plugin
set runtimepath^=$HOME/.vim/custom
let g:UltiSnipsSnippetsDir         =  "~/.vim/custom/mysnippets"
let g:UltiSnipsSnippetDirectories  = ["UltiSnips","mysnippets"]
let g:UltiSnipsEditSplit           =  "vertical"
let g:UltiSnipsEnableSnipMate      =  0
let g:UltiSnipsExpandTrigger       = "<c-j>"
let g:UltiSnipsJumpForwardTrigger  = "<c-j>"
let g:UltiSnipsJumpBackwardTrigger = "<c-k>"

"""" Syntastic
let g:syntastic_check_on_wq              = 0
let g:syntastic_auto_loc_list            = 0
let g:syntastic_always_populate_loc_list = 1
let g:syntastic_tex_checkers             = ['chktex']

""" Clever F
let g:clever_f_smart_case        = 1
let g:clever_f_mark_cursor       = 1
let g:clever_f_mark_cursor_color = 'Error'

""" BufTabLine
let g:buftabline_show       = 1
let g:buftabline_numbers    = 1
let g:buftabline_indicators = 1

" Settings                       {{{1
"

filetype plugin on
filetype indent on
syntax on
augroup colourscheme
	au!
	au VimEnter * colorscheme molokaiV
	au VimEnter,Colorscheme * hi! link ColorColumn CursorLine
augroup END
doautocmd colourscheme VimEnter %
set encoding=utf-8 " character encoding used in Vim: "latin1", "utf-8"

" 1 important {{{2

" 2 moving around, searching and patterns {{{2
set whichwrap=b,s,h,l,<,>,[,] " list of flags specifying which commands wrap to another line
set nostartofline      " many jump commands move the cursor to the first non-blank
set path=.,**          " list of directory names used for file searching
set incsearch          " show match for partly typed search command
set magic              " change the way backslashes are used in search patterns
set ignorecase         " ignore case when using a search pattern
set smartcase          " override 'ignorecase' when pattern has upper case characters

" 4 displaying text {{{2

" 3 tags {{{2
set scrolloff=5      " minimal number of columns to keep left and right of the cursor
set wrap             " margin from the right in which to break a line
set linebreak        " wrap long lines at a character in 'breakat'
set fillchars=vert:│ " characters to use for the status line, folds and filler lines
set cmdheight=1      " number of lines used for the command-line
set lazyredraw       " don't redraw while executing macros
set list             " show <Tab> as ^I and end-of-line as $
set listchars=tab:·\ ,trail:▸,nbsp:#,extends:»,precedes:« " list of strings used for list mode
silent! set listchars+=space:·
augroup vimrc_trailing " {{{
	au!
	au InsertEnter * :set listchars-=trail:▸
	au InsertLeave * :set listchars+=trail:▸
augroup END " }}}
set number                 " show the line number for each line
silent! set relativenumber " show the relative line number for each line

" 5 syntax, highlighting and spelling {{{2
set synmaxcol=200      " maximum column to look for syntax items
set hlsearch           " highlight all matches for the last used search pattern
set cursorline         " highlight the screen line of the cursor
if exists("&colorcolumn")
	set colorcolumn=+1 " columns to highlight
else
	:mat ErrorMsg '\%81v.\+'
endif

" 6 multiple windows {{{2
set laststatus=2     " 0, 1 or 2; when to use a status line for the last window
set hidden           " don't unload a buffer when no longer shown in a window
set switchbuf=usetab " "useopen" and/or "split"; which window to use when jumping
set splitbelow       " a new window is put below the current one
set splitright       " a new window is put right of the current one

" 7 multiple tab pages {{{2
set showtabline=1 " 0, 1 or 2; when to use a tab pages line

" 8 terminal {{{2
set t_vb=

" 9 using the mouse {{{2
set mouse=a   " list of flags for using the mouse
set mousehide " hide the mouse pointer while typing

"10 GUI {{{2
if has('win32') || has('win32unix')
	set guifont=Consolas:h11:cANSI " list of font names to be used in the GUI
else
	set guifont=Droid\ Sans\ Mono\ 10
endif
if has("gui_running")
	" set guioptions+=P "allow visual selection to be accessed in system paste
	set guioptions+=c "use console dialogues
	set guioptions-=L "left hand toolbar isn't present
	set guioptions-=T "remove tool bar
	set guioptions-=m "remove menu bar
	set guioptions-=l "remove right scroll
	set guioptions-=r "remove left scroll
	set guioptions-=b "remove bottom scroll
endif

"11 printing {{{2

"12 messages and info {{{2
set shortmess=aoOstT  " list of flags to make messages shorter
silent! set shortmess+=c
set showcmd           " show (partial) command keys in the status line
set ruler             " show cursor position below each window
set nomore            " pause listings when the screen is full
set novisualbell      " use a visual bell instead of beeping
set noerrorbells      " ring the bell for error messages

"13 selecting text {{{2

"14 editing text {{{2
set textwidth=79                     " line length above which to break a line
set wrapmargin=0                     " margin from the right in which to break a line
set backspace=indent,eol,start       " specifies what <BS>, CTRL-W, etc. can do in Insert mode
set formatoptions=tcrqln             " list of flags that tell how automatic formatting works
silent! set formatoptions+=j         " list of flags that tell how automatic formatting works
set complete=.,w,b,u,k,t             " specifies how Insert mode completion works for CTRL-N and CTRL-P
set completeopt=menu                 " whether to use a popup menu for Insert mode completion
set infercase                        " adjust case of a keyword completion match
set showmatch                        " when inserting a bracket, briefly jump to its match
set matchtime=5                      " tenth of a second to show a match for 'showmatch'

"15 tabs and indenting {{{2
set tabstop=4      " number of spaces a <Tab> in the text stands for
set shiftwidth=4   " number of spaces used for each step of (auto)indent
set smarttab       " a <Tab> in an indent inserts 'shiftwidth' spaces
set softtabstop=0  " if non-zero, number of spaces to insert for a <Tab>
set shiftround     " round to 'shiftwidth' for "<<" and ">>"
set noexpandtab    " expand <Tab> to spaces in Insert mode
set autoindent     " automatically set the indent of a new line
set smartindent    " do clever autoindenting
set copyindent     " copy whitespace for indenting from previous line
set preserveindent " preserve kind of whitespace when changing indent

"16 folding {{{2
set foldminlines=0        " minimum number of screen lines for a fold to be closed
set foldmethod=marker     " folding type: "manual", "indent", "expr", "marker" or "syntax"

"17 diff mode {{{2

"18 mapping {{{2
set timeoutlen=300 " time in msec for 'timeout'

"19 reading and writing files {{{2
set modeline                        " enable using settings from modelines when reading a file
set fileformats=unix,dos,mac        " list of file formats to look for when editing a file
set endofline                       " last line in the file has an end-of-line
set writebackup                     " write a backup file before overwriting a file
set backup                          " write a backup file before overwriting a file
set backupdir=$VIMHOME/tmp/backup// " list of directories to put backup files in
"set autowrite                       " automatically write a file when leaving a modified buffer
set autoread                        " automatically read a file when it was modified outside of Vim

"20 the swap file {{{2
set directory=$VIMHOME/tmp/directory// " list of directories for the swap file
set noswapfile                         " use a swap file for this buffer

"21 command line editing {{{2
set history=700                 " how many command lines are remembered
set wildmode=full               " specifies how command line completion works
" set wildignore=*.o,*~,*.pyc     " ignore case when completing file names
" set wildignore+=*/.git/*,*/.hg/*,*/.svn/*,*.class
" silent! set wildignorecase      " ignore case when completing file names
set wildmenu                    " command-line completion shows a list of matches
set cmdwinheight=3              " height of the command-line window
set undofile                    " automatically save and restore undo history
set undodir=$VIMHOME/tmp/undo// " list of directories for undo files

"22 executing external commands {{{2
if has('win32') && executable('zsh')
	set shell=C:/cygwin/bin/zsh.exe\ -i " name of the shell program used for external commands
	set shellcmdflag=-c                 " argument for 'shell' to execute a command
elseif has('win32')
	set shell=C:/cygwin/bin/bash
	set shellcmdflag=--login\ -c
	set shellxquote=\"
else
	set shell=sh
endif
set keywordprg="" " program used for the "K" command

"23 running make and jumping to errors {{{2
set makeprg=make " program used for the ":make" command

"24 system specific {{{2

"25 language specific {{{2
set isfname-==

"26 multi-byte characters {{{2
set encoding=utf-8 " character encoding used in Vim: "latin1", "utf-8"

"27 various {{{2
set virtualedit+=block " when to use virtual editing: "block", "insert" and/or "all"
set viminfo^=!         " list that specifies what to write in the viminfo file
set viminfo+='2000
set viminfo+=n$HOME/.viminfo

" Make those folders if they don't already exist. " {{{
if !isdirectory(expand(&undodir))
    call mkdir(expand(&undodir), "p")
    call mkdir(expand(&backupdir), "p")
    call mkdir(expand(&directory), "p")
endif " }}}

" go to last cursor position when opening files
augroup vimrc_line_return
	au!
	autocmd BufReadPost *
		\ if line("'\"") > 0 && line("'\"") <= line("$") |
			\ exe "normal! g'\"" |
		\ endif
augroup END

" }}}2

" FileTypes                      {{{1
"

if has("autocmd") && exists("+omnifunc")
autocmd Filetype *
		\	if &omnifunc == "" |
		\		setlocal omnifunc=syntaxcomplete#Complete |
		\	endif
endif

if has('win32') || has('win32unix')
	let dictfile="C:/cygwin/usr/share/dict/words"
else
	let dictfile="/usr/share/dict/words"
endif


" Objects                        {{{2

" Line object
vnoremap il :<c-u>normal! 0vg_<cr>
vnoremap al :<c-u>normal! 0v$<cr>
omap il :normal vil<cr>
omap al :normal val<cr>

" Whole file object
vnoremap if :<c-u>normal! gg0VG<cr>
vnoremap af :<c-u>normal! gg0VG<cr>
omap if :normal vif<cr>
omap af :normal vaf<cr>

" Abbreviations                  {{{1
"

cabbrev help vert help
cabbrev w!! w !sudo tee > /dev/null %

abbrev <expr> dts strftime("%d/%m/%Y")
abbrev <expr> dty strftime("%Y%m%d")
abbrev <expr> dtyd strftime("%Y-%m-%d")
abbrev <expr> dtl strftime("%c")

function! CreatedHeader()
	return "Created:  TIMESTAMP\<CR>"
		\ ."Modified: TIMESTAMP\<CR>"
		\ ."Author:   Josh Wainwright\<CR>"
		\ ."Filename: " . expand('%:t')
endfunction

iabbrev <expr> Cre: CreatedHeader()
iabbrev TST TIMESTAMP

" LDRA                           {{{1
"

iabbrev <expr> Weeklyr "Weekly Report<CR>
                       \=============<CR>
                       \Josh Wainwright<CR>
                       \Week ending " . system("date -d Fri '+%d/%m/%Y'") . "<CR>
                       \- <CR>
                       \<CR>
                       \Customer Site Visits<CR>
                       \--------------------<CR>
                       \<CR>
                       \Vacation<CR>
                       \--------<CR>
                       \- None"

command! TBini :e C:\ProgramData\LDRA\TESTBED.ini
nnoremap <F11> :<C-U>e ~/Documents/Details/ldra-learnt.md<cr>
command! FormatWikiEntry :Tabularize /\(\( \|^\)\zs|\)\|\^

if has("gui_running") && !exists("g:vim_started")
	set lines=40
	exe "set columns=" . (82+&numberwidth)
	let g:vim_started = 1
endif

augroup vimrc_save
	autocmd!
	au VimResized * :wincmd =
augroup END
" }}}

" Keybindings
"         ~/.vim/plugins/keybindings.vim
"         ~\vimfiles\plugin\keybindings.vim
" Functions
"         ~/.vim/autoload/functions.vim
"         ~\vimfiles\autoload\functions.vim
" vim: fdm=marker nowrap
